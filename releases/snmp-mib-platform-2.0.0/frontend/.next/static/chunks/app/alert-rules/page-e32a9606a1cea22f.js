(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1049],{2219:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var l=t(95155),a=t(12115),r=t(54073),n=t(53999);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsxs)(r.bL,{ref:s,className:(0,n.cn)("relative flex w-full touch-none select-none items-center",t),...a,children:[(0,l.jsx)(r.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,l.jsx)(r.Q6,{className:"absolute h-full bg-primary"})}),(0,l.jsx)(r.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});i.displayName=r.bL.displayName},4320:(e,s,t)=>{Promise.resolve().then(t.bind(t,93999))},93999:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var l=t(95155),a=t(12115),r=t(95261),n=t(88482),i=t(97168),c=t(89852),d=t(82714),o=t(99474),u=t(95784),x=t(34964),h=t(88145),m=t(99840),j=t(88524),p=t(95139),g=t(59964),v=t(84616),f=t(47924),y=t(53904),N=t(92657),b=t(13717),w=t(62525),S=t(4229),C=t(56671),A=t(41397),R=t(49026),E=t(2219),T=t(1243),k=t(85339),q=t(23861),P=t(71539),B=t(79397),L=t(40646),I=t(88848);function J(e){let{alertRules:s}=e,[t,r]=(0,a.useState)("rules"),[o,x]=(0,a.useState)([]),[m,j]=(0,a.useState)([]),[g,v]=(0,a.useState)({}),[f,y]=(0,a.useState)(!1),[N,b]=(0,a.useState)(0),w=(e,s)=>{if(s){x(s=>[...s,e]);let s={};e.parameters.forEach(e=>{s[e.name]=e.defaultValue}),v(t=>({...t,[e.id]:s}))}else x(s=>s.filter(s=>s.id!==e.id)),v(s=>{let t={...s};return delete t[e.id],t})},S=(e,s,t)=>{v(l=>({...l,[e]:{...l[e],[s]:t}}))},C=async()=>{if(0!==o.length&&0!==m.length){y(!0),b(0),r("deploy");try{let e=o.map(e=>({...e,config:g[e.id],finalPromql:J(e,g[e.id])})),s=await fetch("/api/alert-rules/deploy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rules:e,hosts:m,deploymentConfig:{alertmanagerUrl:"http://alertmanager:9093",prometheusUrl:"http://prometheus:9090"}})});if((await s.json()).success){let e=setInterval(()=>{b(s=>s>=100?(clearInterval(e),y(!1),100):s+8)},600)}else y(!1)}catch(e){y(!1)}}},J=(e,s)=>{let t=e.promql;return Object.entries(s).forEach(e=>{let[s,l]=e;t=t.replace(RegExp("{{".concat(s,"}}"),"g"),String(l))}),t},O=()=>{"hosts"===t?r("rules"):"config"===t?r("hosts"):"deploy"===t&&r("config")},D=e=>{switch(e){case"critical":return"text-red-600 bg-red-50";case"warning":return"text-yellow-600 bg-yellow-50";case"info":return"text-blue-600 bg-blue-50";default:return"text-gray-600 bg-gray-50"}},Z=e=>{switch(e){case"critical":return T.A;case"warning":return k.A;default:return q.A}};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-center space-x-4 mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 ".concat("rules"===t?"text-blue-600":"hosts"===t||"config"===t||"deploy"===t?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("rules"===t?"bg-blue-600 text-white":"hosts"===t||"config"===t||"deploy"===t?"bg-green-600 text-white":"bg-gray-200"),children:"1"}),(0,l.jsx)("span",{className:"font-medium",children:"选择规则"})]}),(0,l.jsx)("div",{className:"w-8 h-0.5 ".concat("hosts"===t||"config"===t||"deploy"===t?"bg-green-600":"bg-gray-200")}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 ".concat("hosts"===t?"text-blue-600":"config"===t||"deploy"===t?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("hosts"===t?"bg-blue-600 text-white":"config"===t||"deploy"===t?"bg-green-600 text-white":"bg-gray-200"),children:"2"}),(0,l.jsx)("span",{className:"font-medium",children:"选择主机"})]}),(0,l.jsx)("div",{className:"w-8 h-0.5 ".concat("config"===t||"deploy"===t?"bg-green-600":"bg-gray-200")}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 ".concat("config"===t?"text-blue-600":"deploy"===t?"text-green-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("config"===t?"bg-blue-600 text-white":"deploy"===t?"bg-green-600 text-white":"bg-gray-200"),children:"3"}),(0,l.jsx)("span",{className:"font-medium",children:"配置阈值"})]}),(0,l.jsx)("div",{className:"w-8 h-0.5 ".concat("deploy"===t?"bg-green-600":"bg-gray-200")}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 ".concat("deploy"===t?"text-blue-600":"text-gray-400"),children:[(0,l.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("deploy"===t?"bg-blue-600 text-white":"bg-gray-200"),children:"4"}),(0,l.jsx)("span",{className:"font-medium",children:"执行部署"})]})]}),"rules"===t&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsx)(n.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(n.ZB,{children:"选择告警规则"}),(0,l.jsx)(n.BT,{children:"选择要部署的告警规则模板"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)(h.E,{variant:"outline",children:["已选择 ",o.length," 个规则"]}),(0,l.jsx)(i.$,{onClick:()=>{"rules"===t&&o.length>0&&r("hosts")},disabled:0===o.length,children:"下一步: 选择主机"})]})]})}),(0,l.jsx)(n.Wu,{children:(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>{let s=o.some(s=>s.id===e.id),t=Z(e.severity);return(0,l.jsxs)(n.Zp,{className:"cursor-pointer transition-all hover:shadow-md ".concat(s?"ring-2 ring-blue-500":""),onClick:()=>w(e,!s),children:[(0,l.jsxs)(n.aR,{className:"pb-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(p.S,{checked:s,readOnly:!0}),(0,l.jsx)(n.ZB,{className:"text-base",children:e.name})]}),(0,l.jsx)("div",{className:"p-1 rounded ".concat(D(e.severity)),children:(0,l.jsx)(t,{className:"h-4 w-4"})})]}),(0,l.jsx)(n.BT,{className:"text-sm",children:e.description})]}),(0,l.jsx)(n.Wu,{children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-muted-foreground",children:"严重级别"}),(0,l.jsx)(h.E,{variant:"outline",className:D(e.severity),children:e.severity})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-muted-foreground",children:"默认阈值"}),(0,l.jsx)("span",{children:e.defaultThreshold})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-muted-foreground",children:"持续时间"}),(0,l.jsx)("span",{children:e.defaultDuration})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.targetMetrics.slice(0,2).map(e=>(0,l.jsx)(h.E,{variant:"secondary",className:"text-xs",children:e},e)),e.targetMetrics.length>2&&(0,l.jsxs)(h.E,{variant:"secondary",className:"text-xs",children:["+",e.targetMetrics.length-2]})]})]})})]},e.id)})})})]})}),"hosts"===t&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{children:"选择监控主机"}),(0,l.jsx)(n.BT,{children:"选择要应用告警规则的监控主机"})]}),(0,l.jsx)(n.Wu,{children:(0,l.jsx)(I.W,{selectedComponents:["prometheus","alertmanager"],onHostsSelected:e=>{j(e),r("config")},onBack:O})})]})}),"config"===t&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{children:"配置告警参数"}),(0,l.jsx)(n.BT,{children:"为每个告警规则设置具体的阈值和参数"})]}),(0,l.jsxs)(n.Wu,{children:[(0,l.jsx)("div",{className:"space-y-6",children:o.map(e=>(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(n.ZB,{className:"text-base",children:e.name}),(0,l.jsx)(h.E,{variant:"outline",className:D(e.severity),children:e.severity})]}),(0,l.jsx)(n.BT,{children:e.description})]}),(0,l.jsxs)(n.Wu,{children:[(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:e.parameters.map(s=>{var t,a,r,n,i;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(d.J,{htmlFor:"".concat(e.id,"-").concat(s.name),children:[s.name,s.unit&&(0,l.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(",s.unit,")"]})]}),"number"===s.type&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.p,{id:"".concat(e.id,"-").concat(s.name),type:"number",value:(null===(t=g[e.id])||void 0===t?void 0:t[s.name])||"",onChange:t=>S(e.id,s.name,Number(t.target.value)),min:s.min,max:s.max}),void 0!==s.min&&void 0!==s.max&&(0,l.jsx)(E.A,{value:[(null===(a=g[e.id])||void 0===a?void 0:a[s.name])||s.defaultValue],onValueChange:t=>{let[l]=t;return S(e.id,s.name,l)},min:s.min,max:s.max,step:1,className:"w-full"})]}),"duration"===s.type&&(0,l.jsxs)(u.l6,{value:(null===(r=g[e.id])||void 0===r?void 0:r[s.name])||"",onValueChange:t=>S(e.id,s.name,t),children:[(0,l.jsx)(u.bq,{children:(0,l.jsx)(u.yv,{placeholder:"选择持续时间"})}),(0,l.jsxs)(u.gC,{children:[(0,l.jsx)(u.eb,{value:"1m",children:"1分钟"}),(0,l.jsx)(u.eb,{value:"5m",children:"5分钟"}),(0,l.jsx)(u.eb,{value:"10m",children:"10分钟"}),(0,l.jsx)(u.eb,{value:"30m",children:"30分钟"}),(0,l.jsx)(u.eb,{value:"1h",children:"1小时"})]})]}),"select"===s.type&&s.options&&(0,l.jsxs)(u.l6,{value:(null===(n=g[e.id])||void 0===n?void 0:n[s.name])||"",onValueChange:t=>S(e.id,s.name,t),children:[(0,l.jsx)(u.bq,{children:(0,l.jsx)(u.yv,{placeholder:s.description})}),(0,l.jsx)(u.gC,{children:s.options.map(e=>(0,l.jsx)(u.eb,{value:e,children:e},e))})]}),"boolean"===s.type&&(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(p.S,{id:"".concat(e.id,"-").concat(s.name),checked:(null===(i=g[e.id])||void 0===i?void 0:i[s.name])||!1,onCheckedChange:t=>S(e.id,s.name,t)}),(0,l.jsx)(d.J,{htmlFor:"".concat(e.id,"-").concat(s.name),className:"text-sm",children:s.description})]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:s.description})]},s.name)})}),(0,l.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[(0,l.jsx)(d.J,{className:"text-sm font-medium",children:"生成的PromQL:"}),(0,l.jsx)("pre",{className:"text-xs mt-1 overflow-auto",children:J(e,g[e.id]||{})})]})]})]},e.id))}),(0,l.jsx)("div",{className:"mt-6 pt-6 border-t",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium",children:"部署摘要"}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:["将 ",o.length," 个告警规则部署到 ",m.length," 台主机"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(i.$,{variant:"outline",onClick:O,children:"返回"}),(0,l.jsxs)(i.$,{onClick:C,children:[(0,l.jsx)(P.A,{className:"mr-2 h-4 w-4"}),"开始部署"]})]})]})})]})]})}),"deploy"===t&&(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{children:"告警规则部署进度"}),(0,l.jsx)(n.BT,{children:"正在将告警规则部署到选定的主机"})]}),(0,l.jsx)(n.Wu,{children:f?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)(R.Fc,{children:[(0,l.jsx)(B.A,{className:"h-4 w-4"}),(0,l.jsxs)(R.TN,{children:["正在部署告警规则... ",N,"%",(0,l.jsx)(A.k,{value:N,className:"mt-2"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h4",{className:"font-medium",children:"部署详情"}),(0,l.jsxs)("div",{className:"text-sm space-y-1",children:[(0,l.jsxs)("div",{children:["告警规则: ",o.length," 个"]}),(0,l.jsxs)("div",{children:["目标主机: ",m.length," 台"]}),(0,l.jsx)("div",{children:"部署组件: Prometheus + Alertmanager"})]})]})]}):(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)(L.A,{className:"mx-auto h-12 w-12 text-green-600"}),(0,l.jsx)("h3",{className:"mt-4 text-lg font-medium",children:"部署完成"}),(0,l.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"告警规则已成功部署到所有选定的主机"}),(0,l.jsxs)("div",{className:"mt-4 space-x-2",children:[(0,l.jsx)(i.$,{variant:"outline",onClick:()=>r("rules"),children:"部署新规则"}),(0,l.jsx)(i.$,{onClick:()=>window.location.reload(),children:"查看告警状态"})]})]})})]})})]})}function O(){let[e,s]=(0,a.useState)([]),[t,A]=(0,a.useState)([]),[R,E]=(0,a.useState)([]),[T,k]=(0,a.useState)(!0),[q,P]=(0,a.useState)(0),[B,L]=(0,a.useState)(1),[I,O]=(0,a.useState)("rules"),[D,Z]=(0,a.useState)([]),[M,V]=(0,a.useState)(""),[U,W]=(0,a.useState)("all"),[$,F]=(0,a.useState)("all"),[z,_]=(0,a.useState)(!1),[G,H]=(0,a.useState)(null),[X,Q]=(0,a.useState)(!1),Y=async()=>{try{k(!0);let e=await r.u.getAlertRules({page:B,limit:10,search:M,status:"all"===$?void 0:$});s(e.rules||[]),P(e.total||0)}catch(e){C.oR.error("Failed to load alert rules"),s([])}finally{k(!1)}},K=async()=>{};(0,a.useEffect)(()=>{Y(),K()},[B,M,$]);let ee=async e=>{try{await r.u.createAlertRule(e),C.oR.success("Alert rule created successfully"),_(!1),H(null),Y()}catch(e){C.oR.error("Failed to create alert rule")}},es=async e=>{try{await r.u.updateAlertRule(G.id,e),C.oR.success("Alert rule updated successfully"),_(!1),H(null),Y()}catch(e){C.oR.error("Failed to update alert rule")}},et=async e=>{try{await r.u.deleteAlertRule(e),C.oR.success("Alert rule deleted successfully"),Y()}catch(e){C.oR.error("Failed to delete alert rule")}},el=e=>{H(e),_(!0)},ea=e.filter(e=>{var s,t,l;let a=(null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(M.toLowerCase()))||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(M.toLowerCase()))||(null===(l=e.tags)||void 0===l?void 0:l.some(e=>e.toLowerCase().includes(M.toLowerCase()))),r="all"===U||e.severity===U,n="all"===$||e.status===$;return a&&r&&n}),er=e=>{switch(e){case"active":return(0,l.jsx)(h.E,{className:"bg-green-100 text-green-800",children:"Active"});case"firing":return(0,l.jsx)(h.E,{variant:"destructive",children:"Firing"});case"pending":return(0,l.jsx)(h.E,{className:"bg-yellow-100 text-yellow-800",children:"Pending"});case"inactive":return(0,l.jsx)(h.E,{variant:"secondary",children:"Inactive"});default:return(0,l.jsx)(h.E,{variant:"outline",children:"Unknown"})}},en=e=>{switch(e){case"critical":return(0,l.jsx)(h.E,{variant:"destructive",children:"Critical"});case"warning":return(0,l.jsx)(h.E,{className:"bg-yellow-100 text-yellow-800",children:"Warning"});case"info":return(0,l.jsx)(h.E,{className:"bg-blue-100 text-blue-800",children:"Info"});default:return(0,l.jsx)(h.E,{variant:"outline",children:"Unknown"})}};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Alert Rules"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Manage monitoring alert rules and templates"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)(i.$,{variant:"outline",onClick:()=>Q(!0),children:[(0,l.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Deploy Rules"]}),(0,l.jsxs)(i.$,{onClick:()=>_(!0),children:[(0,l.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Create Rule"]})]})]}),(0,l.jsxs)(x.tU,{value:I,onValueChange:O,children:[(0,l.jsxs)(x.j7,{children:[(0,l.jsx)(x.Xi,{value:"rules",children:"Alert Rules"}),(0,l.jsx)(x.Xi,{value:"templates",children:"Templates"}),(0,l.jsx)(x.Xi,{value:"groups",children:"Device Groups"})]}),(0,l.jsx)(x.av,{value:"rules",className:"space-y-4",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsx)(n.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(n.ZB,{children:"Alert Rules"}),(0,l.jsxs)(n.BT,{children:["Total: ",q," rules"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(f.A,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(c.p,{placeholder:"Search rules...",value:M,onChange:e=>V(e.target.value),className:"pl-8 w-64"})]}),(0,l.jsxs)(u.l6,{value:U,onValueChange:W,children:[(0,l.jsx)(u.bq,{className:"w-[120px]",children:(0,l.jsx)(u.yv,{placeholder:"Severity"})}),(0,l.jsxs)(u.gC,{children:[(0,l.jsx)(u.eb,{value:"all",children:"All"}),(0,l.jsx)(u.eb,{value:"critical",children:"Critical"}),(0,l.jsx)(u.eb,{value:"warning",children:"Warning"}),(0,l.jsx)(u.eb,{value:"info",children:"Info"})]})]}),(0,l.jsxs)(u.l6,{value:$,onValueChange:F,children:[(0,l.jsx)(u.bq,{className:"w-[120px]",children:(0,l.jsx)(u.yv,{placeholder:"Status"})}),(0,l.jsxs)(u.gC,{children:[(0,l.jsx)(u.eb,{value:"all",children:"All"}),(0,l.jsx)(u.eb,{value:"active",children:"Active"}),(0,l.jsx)(u.eb,{value:"firing",children:"Firing"}),(0,l.jsx)(u.eb,{value:"pending",children:"Pending"}),(0,l.jsx)(u.eb,{value:"inactive",children:"Inactive"})]})]}),(0,l.jsxs)(i.$,{variant:"outline",onClick:Y,disabled:T,children:[(0,l.jsx)(y.A,{className:"h-4 w-4 mr-2 ".concat(T?"animate-spin":"")}),"Refresh"]})]})]})}),(0,l.jsx)(n.Wu,{children:(0,l.jsx)("div",{className:"rounded-md border",children:(0,l.jsxs)(j.XI,{children:[(0,l.jsx)(j.A0,{children:(0,l.jsxs)(j.Hj,{children:[(0,l.jsx)(j.nd,{className:"w-12",children:(0,l.jsx)(p.S,{})}),(0,l.jsx)(j.nd,{children:"Rule Name"}),(0,l.jsx)(j.nd,{children:"Severity"}),(0,l.jsx)(j.nd,{children:"Status"}),(0,l.jsx)(j.nd,{children:"Device Group"}),(0,l.jsx)(j.nd,{children:"Last Triggered"}),(0,l.jsx)(j.nd,{className:"text-right",children:"Actions"})]})}),(0,l.jsx)(j.BF,{children:T?(0,l.jsx)(j.Hj,{children:(0,l.jsx)(j.nA,{colSpan:7,className:"text-center py-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)(y.A,{className:"h-4 w-4 animate-spin mr-2"}),"Loading alert rules..."]})})}):0===ea.length?(0,l.jsx)(j.Hj,{children:(0,l.jsx)(j.nA,{colSpan:7,className:"text-center py-8",children:"No alert rules found"})}):ea.map(e=>(0,l.jsxs)(j.Hj,{children:[(0,l.jsx)(j.nA,{children:(0,l.jsx)(p.S,{})}),(0,l.jsx)(j.nA,{children:(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:e.name}),(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]})}),(0,l.jsx)(j.nA,{children:en(e.severity)}),(0,l.jsx)(j.nA,{children:er(e.status)}),(0,l.jsx)(j.nA,{children:e.deviceGroup}),(0,l.jsx)(j.nA,{children:e.lastTriggered||"Never"}),(0,l.jsx)(j.nA,{className:"text-right",children:(0,l.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,l.jsx)(i.$,{variant:"ghost",size:"sm",children:(0,l.jsx)(N.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>el(e),children:(0,l.jsx)(b.A,{className:"h-4 w-4"})}),(0,l.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>et(e.id),children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]})}),(0,l.jsx)(x.av,{value:"templates",className:"space-y-4",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{children:"Rule Templates"}),(0,l.jsx)(n.BT,{children:"Pre-configured alert rule templates"})]}),(0,l.jsx)(n.Wu,{children:(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("p",{className:"text-muted-foreground",children:"Templates will be loaded from API"})})})]})}),(0,l.jsx)(x.av,{value:"groups",className:"space-y-4",children:(0,l.jsxs)(n.Zp,{children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsx)(n.ZB,{children:"Device Groups"}),(0,l.jsx)(n.BT,{children:"Manage device groups for alert rules"})]}),(0,l.jsx)(n.Wu,{children:(0,l.jsx)("div",{className:"text-center py-8",children:(0,l.jsx)("p",{className:"text-muted-foreground",children:"Device groups will be loaded from API"})})})]})})]}),(0,l.jsx)(m.lG,{open:z,onOpenChange:_,children:(0,l.jsxs)(m.Cf,{className:"max-w-2xl",children:[(0,l.jsxs)(m.c7,{children:[(0,l.jsx)(m.L3,{children:G?"Edit Alert Rule":"Create Alert Rule"}),(0,l.jsx)(m.rr,{children:"Configure alert rule parameters and conditions"})]}),(0,l.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Rule Name"}),(0,l.jsx)(c.p,{defaultValue:null==G?void 0:G.name,placeholder:"Enter rule name",className:"mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Severity"}),(0,l.jsxs)(u.l6,{defaultValue:(null==G?void 0:G.severity)||"warning",children:[(0,l.jsx)(u.bq,{className:"mt-1",children:(0,l.jsx)(u.yv,{placeholder:"Select severity"})}),(0,l.jsxs)(u.gC,{children:[(0,l.jsx)(u.eb,{value:"critical",children:"Critical"}),(0,l.jsx)(u.eb,{value:"warning",children:"Warning"}),(0,l.jsx)(u.eb,{value:"info",children:"Info"})]})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Description"}),(0,l.jsx)(c.p,{defaultValue:null==G?void 0:G.description,placeholder:"Enter rule description",className:"mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"PromQL Expression"}),(0,l.jsx)(o.T,{defaultValue:null==G?void 0:G.promql,placeholder:"Enter PromQL query expression...",rows:3,className:"mt-1 font-mono"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Threshold"}),(0,l.jsx)(c.p,{type:"number",defaultValue:null==G?void 0:G.threshold,placeholder:"80",className:"mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Duration"}),(0,l.jsx)(c.p,{defaultValue:(null==G?void 0:G.duration)||"5m",placeholder:"5m",className:"mt-1"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{children:"Tags"}),(0,l.jsx)(c.p,{placeholder:"Enter tags, separated by commas",className:"mt-1"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)(i.$,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),(0,l.jsxs)(i.$,{onClick:()=>{G?es({}):ee({})},children:[(0,l.jsx)(S.A,{className:"mr-2 h-4 w-4"}),G?"Update Rule":"Create Rule"]})]})]})}),X&&(0,l.jsx)(J,{onClose:()=>Q(!1),selectedRules:D})]})}},95261:(e,s,t)=>{"use strict";t.d(s,{u:()=>r});let l=t(49509).env.NEXT_PUBLIC_API_URL||"http://localhost:17880/api/v1";class a{async request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="".concat(l).concat(e),a=await fetch(t,{headers:{"Content-Type":"application/json",...s.headers},...s});if(!a.ok)throw Error("API请求失败: ".concat(a.status," ").concat(a.statusText));return a.json()}async getDevices(e){let s=new URLSearchParams;return(null==e?void 0:e.page)&&s.set("page",e.page.toString()),(null==e?void 0:e.limit)&&s.set("limit",e.limit.toString()),(null==e?void 0:e.search)&&s.set("search",e.search),(null==e?void 0:e.type)&&s.set("type",e.type),(null==e?void 0:e.status)&&s.set("status",e.status),this.request("/devices?".concat(s))}async getDevice(e){return this.request("/devices/".concat(e))}async createDevice(e){return this.request("/devices",{method:"POST",body:JSON.stringify(e)})}async updateDevice(e,s){return this.request("/devices/".concat(e),{method:"PUT",body:JSON.stringify(s)})}async deleteDevice(e){return this.request("/devices/".concat(e),{method:"DELETE"})}async getMIBs(e){let s=new URLSearchParams;return(null==e?void 0:e.page)&&s.set("page",e.page.toString()),(null==e?void 0:e.limit)&&s.set("limit",e.limit.toString()),(null==e?void 0:e.search)&&s.set("search",e.search),this.request("/mibs?".concat(s))}async getMIB(e){return this.request("/mibs/".concat(e))}async uploadMIB(e){let s=new FormData;s.append("file",e);let t=await fetch("".concat(l,"/mibs/upload"),{method:"POST",body:s});if(!t.ok)throw Error("MIB上传失败: ".concat(t.status," ").concat(t.statusText));return t.json()}async deleteMIB(e){return this.request("/mibs/".concat(e),{method:"DELETE"})}async getAlertRules(e){let s=new URLSearchParams;return(null==e?void 0:e.page)&&s.set("page",e.page.toString()),(null==e?void 0:e.limit)&&s.set("limit",e.limit.toString()),(null==e?void 0:e.search)&&s.set("search",e.search),(null==e?void 0:e.groupId)&&s.set("groupId",e.groupId),(null==e?void 0:e.status)&&s.set("status",e.status),this.request("/alert-rules?".concat(s))}async getAlertRule(e){return this.request("/alert-rules/".concat(e))}async createAlertRule(e){return this.request("/alert-rules",{method:"POST",body:JSON.stringify(e)})}async updateAlertRule(e,s){return this.request("/alert-rules/".concat(e),{method:"PUT",body:JSON.stringify(s)})}async deleteAlertRule(e){return this.request("/alert-rules/".concat(e),{method:"DELETE"})}async getMonitoringComponents(){return this.request("/monitoring/components")}async installMonitoringComponent(e,s){return this.request("/monitoring/install",{method:"POST",body:JSON.stringify({componentId:e,config:s})})}async getMonitoringStatus(){return this.request("/monitoring/status")}async performSNMPWalk(e,s,t){return this.request("/snmp/walk",{method:"POST",body:JSON.stringify({target:e,oid:s,community:t})})}async performSNMPGet(e,s,t){return this.request("/snmp/get",{method:"POST",body:JSON.stringify({target:e,oid:s,community:t})})}async getHealthStatus(){return this.request("/health")}}let r=new a},99474:(e,s,t)=>{"use strict";t.d(s,{T:()=>n});var l=t(95155),a=t(12115),r=t(53999);let n=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...a})});n.displayName="Textarea"},99840:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>x,Es:()=>m,L3:()=>j,c7:()=>h,lG:()=>c,rr:()=>p,zM:()=>d});var l=t(95155),a=t(12115),r=t(15452),n=t(54416),i=t(53999);let c=r.bL,d=r.l9,o=r.ZL;r.bm;let u=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.hJ,{ref:s,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...a})});u.displayName=r.hJ.displayName;let x=a.forwardRef((e,s)=>{let{className:t,children:a,...c}=e;return(0,l.jsxs)(o,{children:[(0,l.jsx)(u,{}),(0,l.jsxs)(r.UC,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...c,children:[a,(0,l.jsxs)(r.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(n.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});x.displayName=r.UC.displayName;let h=e=>{let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};h.displayName="DialogHeader";let m=e=>{let{className:s,...t}=e;return(0,l.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};m.displayName="DialogFooter";let j=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.hE,{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",t),...a})});j.displayName=r.hE.displayName;let p=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,l.jsx)(r.VY,{ref:s,className:(0,i.cn)("text-sm text-muted-foreground",t),...a})});p.displayName=r.VY.displayName}},e=>{var s=s=>e(e.s=s);e.O(0,[8096,1592,7358],()=>s(4320)),_N_E=e.O()}]);