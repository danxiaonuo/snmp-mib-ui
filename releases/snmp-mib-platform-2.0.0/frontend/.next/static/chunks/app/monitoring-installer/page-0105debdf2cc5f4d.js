(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7492],{16891:(e,s,a)=>{"use strict";a.d(s,{F:()=>i});var t=a(95155),n=a(12115),l=a(47655),r=a(53999);let i=n.forwardRef((e,s)=>{let{className:a,children:n,...i}=e;return(0,t.jsxs)(l.bL,{ref:s,className:(0,r.cn)("relative overflow-hidden",a),...i,children:[(0,t.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,t.jsx)(c,{}),(0,t.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let c=n.forwardRef((e,s)=>{let{className:a,orientation:n="vertical",...i}=e;return(0,t.jsx)(l.VM,{ref:s,orientation:n,className:(0,r.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,t.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=l.VM.displayName},44109:(e,s,a)=>{Promise.resolve().then(a.bind(a,97782))},97782:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>et});var t=a(95155),n=a(12115),l=a(88482),r=a(97168),i=a(88145),c=a(49026),d=a(34964),o=a(41397),x=a(25487),m=a(54213),h=a(72713),j=a(23861),u=a(381),g=a(14738),p=a(53904),v=a(79397),f=a(40646),N=a(85339),y=a(19145),w=a(18979),b=a(95066),S=a(88848),A=a(95139),k=a(89852),C=a(82714),R=a(95784),E=a(88524),T=a(54059),H=a(9428),B=a(53999);let P=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(T.bL,{className:(0,B.cn)("grid gap-2",a),...n,ref:s})});P.displayName=T.bL.displayName;let Z=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)(T.q7,{ref:s,className:(0,B.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...n,children:(0,t.jsx)(T.C1,{className:"flex items-center justify-center",children:(0,t.jsx)(H.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});Z.displayName=T.q7.displayName;var I=a(41684),F=a(37108),$=a(91788),z=a(47924),O=a(73314),D=a(73558),L=a(95880),J=a(81284);let W=[{id:"binary",name:"二进制部署",description:"直接使用编译好的二进制文件部署，无需容器环境",icon:(0,t.jsx)(I.A,{className:"h-5 w-5"}),requirements:["SSH访问权限","目标目录写入权限"],advantages:["性能最优","资源占用最少","启动速度快","无需Docker环境"],disadvantages:["需要手动管理依赖","升级相对复杂"]},{id:"docker",name:"Docker容器",description:"使用Docker容器部署，环境隔离性好",icon:(0,t.jsx)(F.A,{className:"h-5 w-5"}),requirements:["Docker环境","Docker Compose（可选）"],advantages:["环境隔离","部署简单","版本管理方便","回滚容易"],disadvantages:["需要Docker环境","资源开销较大"]},{id:"systemd",name:"Systemd服务",description:"作为系统服务运行，由systemd管理",icon:(0,t.jsx)(u.A,{className:"h-5 w-5"}),requirements:["Systemd支持","Root权限"],advantages:["系统集成度高","开机自启","日志管理完善"],disadvantages:["仅支持Linux","需要Root权限"]},{id:"package",name:"包管理器",description:"通过系统包管理器安装（apt、yum等）",icon:(0,t.jsx)($.A,{className:"h-5 w-5"}),requirements:["包管理器","软件源配置"],advantages:["系统集成","依赖自动处理","安全更新"],disadvantages:["版本可能滞后","需要配置软件源"]}];function q(e){var s,a;let{selectedComponent:o,onHostsSelected:m,onBack:h}=e,[j,u]=(0,n.useState)([]),[g,v]=(0,n.useState)(new Set),[y,w]=(0,n.useState)("binary"),[b,S]=(0,n.useState)(!0),[T,H]=(0,n.useState)(""),[B,I]=(0,n.useState)("all"),[F,$]=(0,n.useState)("method"),q=async()=>{S(!0);try{let e=await fetch("/api/hosts?component=".concat(o.id)),s=await e.json();s.success&&u(s.hosts)}catch(e){}finally{S(!1)}},M=j.filter(e=>{var s;let a=e.name.toLowerCase().includes(T.toLowerCase())||e.ip.includes(T)||(null===(s=e.hostname)||void 0===s?void 0:s.toLowerCase().includes(T.toLowerCase())),t="all"===B||e.group===B;return a&&t}),U=Array.from(new Set(j.map(e=>e.group))),V=e=>{let s=new Set(g);s.has(e)?s.delete(e):s.add(e),v(s)},X=(e,s)=>{switch(s){case"docker":case"systemd":return e.os.toLowerCase().includes("linux")||e.os.toLowerCase().includes("ubuntu");case"binary":default:return!0;case"package":return e.os.toLowerCase().includes("ubuntu")||e.os.toLowerCase().includes("centos")}},K=e=>j.filter(s=>X(s,e)).length;return(0,n.useEffect)(()=>{q()},[o.id]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"选择部署方式和目标主机"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["为 ",o.name," 选择合适的部署方式和目标主机"]})]}),(0,t.jsx)(r.$,{variant:"outline",onClick:h,children:"返回"})]}),(0,t.jsxs)(d.tU,{value:F,onValueChange:$,children:[(0,t.jsxs)(d.j7,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(d.Xi,{value:"method",children:"部署方式"}),(0,t.jsx)(d.Xi,{value:"hosts",children:"目标主机"})]}),(0,t.jsx)(d.av,{value:"method",className:"space-y-4",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsx)(l.ZB,{children:"选择部署方式"}),(0,t.jsx)(l.BT,{children:"根据您的环境和需求选择最适合的部署方式"})]}),(0,t.jsxs)(l.Wu,{children:[(0,t.jsx)(P,{value:y,onValueChange:w,className:"space-y-4",children:W.map(e=>(0,t.jsx)("div",{className:"space-y-3",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[(0,t.jsx)(Z,{value:e.id,id:e.id}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.icon,(0,t.jsx)(C.J,{htmlFor:e.id,className:"text-base font-medium cursor-pointer",children:e.name}),(0,t.jsxs)(i.E,{variant:"outline",children:[K(e.id)," 台兼容主机"]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium text-gray-700 mb-1",children:"系统要求:"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.requirements.map((e,s)=>(0,t.jsxs)("li",{className:"text-muted-foreground",children:["• ",e]},s))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium text-green-700 mb-1",children:"优势:"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.advantages.map((e,s)=>(0,t.jsxs)("li",{className:"text-green-600",children:["• ",e]},s))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h5",{className:"font-medium text-orange-700 mb-1",children:"注意事项:"}),(0,t.jsx)("ul",{className:"space-y-1",children:e.disadvantages.map((e,s)=>(0,t.jsxs)("li",{className:"text-orange-600",children:["• ",e]},s))})]})]})]})]})},e.id))}),(0,t.jsx)("div",{className:"mt-6 flex justify-end",children:(0,t.jsxs)(r.$,{onClick:()=>$("hosts"),className:"flex items-center gap-2",children:["下一步：选择主机",(0,t.jsx)(x.A,{className:"h-4 w-4"})]})})]})]})}),(0,t.jsxs)(d.av,{value:"hosts",className:"space-y-4",children:[(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5"}),"选择目标主机",(0,t.jsx)(i.E,{variant:"outline",children:"binary"===y?"二进制部署":"docker"===y?"Docker部署":"systemd"===y?"Systemd服务":"包管理器"})]}),(0,t.jsxs)(l.BT,{children:["选择要部署 ",o.name," 的目标主机"]})]}),(0,t.jsxs)(l.Wu,{children:[(0,t.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(z.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(k.p,{placeholder:"搜索主机名、IP或主机名...",value:T,onChange:e=>H(e.target.value),className:"pl-10"})]})}),(0,t.jsxs)(R.l6,{value:B,onValueChange:I,children:[(0,t.jsx)(R.bq,{className:"w-48",children:(0,t.jsx)(R.yv,{placeholder:"选择主机组"})}),(0,t.jsxs)(R.gC,{children:[(0,t.jsx)(R.eb,{value:"all",children:"所有主机组"}),U.map(e=>(0,t.jsx)(R.eb,{value:e,children:e},e))]})]}),(0,t.jsx)(r.$,{variant:"outline",onClick:q,disabled:b,children:(0,t.jsx)(p.A,{className:"h-4 w-4 ".concat(b?"animate-spin":"")})})]}),b?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(p.A,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),(0,t.jsx)("p",{children:"加载主机列表..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(A.S,{checked:g.size===M.length&&M.length>0,onCheckedChange:()=>{g.size===M.length?v(new Set):v(new Set(M.map(e=>e.id)))}}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["已选择 ",g.size," / ",M.length," 台主机"]})]}),(0,t.jsxs)(i.E,{variant:"outline",children:[M.filter(e=>X(e,y)).length," 台兼容主机"]})]}),(0,t.jsx)("div",{className:"border rounded-lg",children:(0,t.jsxs)(E.XI,{children:[(0,t.jsx)(E.A0,{children:(0,t.jsxs)(E.Hj,{children:[(0,t.jsx)(E.nd,{className:"w-12"}),(0,t.jsx)(E.nd,{children:"主机信息"}),(0,t.jsx)(E.nd,{children:"系统信息"}),(0,t.jsx)(E.nd,{children:"资源配置"}),(0,t.jsx)(E.nd,{children:"状态"}),(0,t.jsx)(E.nd,{children:"兼容性"})]})}),(0,t.jsx)(E.BF,{children:M.map(e=>{let s=X(e,y);return(0,t.jsxs)(E.Hj,{className:s?"":"opacity-50",children:[(0,t.jsx)(E.nA,{children:(0,t.jsx)(A.S,{checked:g.has(e.id),onCheckedChange:()=>V(e.id),disabled:!s})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.ip}),e.hostname&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.hostname})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-sm",children:[e.os," ",e.osVersion]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.arch})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(O.A,{className:"h-3 w-3"}),e.cpuCores," 核"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(D.A,{className:"h-3 w-3"}),Math.round(e.memory/1024)," GB"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(L.A,{className:"h-3 w-3"}),e.disk," GB"]})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsx)(i.E,{variant:"online"===e.status?"default":"secondary",children:"online"===e.status?"在线":"离线"})}),(0,t.jsx)(E.nA,{children:s?(0,t.jsxs)(i.E,{variant:"default",className:"bg-green-100 text-green-800",children:[(0,t.jsx)(f.A,{className:"h-3 w-3 mr-1"}),"兼容"]}):(0,t.jsxs)(i.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:[(0,t.jsx)(N.A,{className:"h-3 w-3 mr-1"}),"不兼容"]})})]},e.id)})})]})}),0===M.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"没有找到匹配的主机"})]}),(0,t.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,t.jsx)(r.$,{variant:"outline",onClick:()=>$("method"),children:"返回选择部署方式"}),(0,t.jsxs)(r.$,{onClick:()=>{m(j.filter(e=>g.has(e.id)),y)},disabled:0===g.size,className:"flex items-center gap-2",children:["继续部署 (",g.size," 台主机)",(0,t.jsx)(f.A,{className:"h-4 w-4"})]})]})]})]}),y&&(0,t.jsxs)(c.Fc,{children:[(0,t.jsx)(J.A,{className:"h-4 w-4"}),(0,t.jsxs)(c.TN,{children:[(0,t.jsx)("strong",{children:"部署方式说明:"})," ",null===(s=W.find(e=>e.id===y))||void 0===s?void 0:s.description,(0,t.jsx)("br",{}),(0,t.jsx)("strong",{children:"系统要求:"})," ",null===(a=W.find(e=>e.id===y))||void 0===a?void 0:a.requirements.join("、")]})]})]})]})]})}var M=a(99474),U=a(54861),V=a(14186),X=a(85690),K=a(84616),_=a(56671);function G(e){let{onHostsSelected:s,onBack:a}=e,[m,h]=(0,n.useState)("discover"),[j,u]=(0,n.useState)([]),[g,v]=(0,n.useState)([]),[N,y]=(0,n.useState)(new Set),[w,b]=(0,n.useState)(!1),[S,R]=(0,n.useState)(!1),[T,H]=(0,n.useState)({name:"",ipRange:"",ports:"22,80,443,9100",timeout:5,concurrent:50}),[B,P]=(0,n.useState)({name:"",ip:"",sshPort:22,sshUser:"",sshPassword:"",sshKey:""}),Z=async()=>{if(!T.name||!T.ipRange){_.oR.error("请填写任务名称和IP范围");return}let e={id:Date.now().toString(),name:T.name,ipRange:T.ipRange,ports:T.ports,status:"running",progress:0,totalHosts:0,foundHosts:0,onlineHosts:0,startedAt:new Date().toISOString()};u(s=>[...s,e]),b(!0);try{let s=await fetch("/api/hosts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"discover",ipRange:T.ipRange,ports:T.ports.split(",").map(e=>parseInt(e.trim())),timeout:T.timeout,concurrent:T.concurrent})}),a=await s.json();a.success?(b(!1),u(s=>s.map(s=>s.id===e.id?{...s,status:"completed",progress:100,foundHosts:a.foundHosts,onlineHosts:a.onlineHosts,completedAt:new Date().toISOString()}:s)),a.hosts&&v(e=>[...e,...a.hosts]),_.oR.success("发现任务完成，找到 ".concat(a.foundHosts," 台主机"))):(b(!1),u(s=>s.map(s=>s.id===e.id?{...s,status:"failed"}:s)),_.oR.error("发现任务启动失败"))}catch(s){b(!1),u(s=>s.map(s=>s.id===e.id?{...s,status:"failed"}:s)),_.oR.error("发现任务启动失败")}H({name:"",ipRange:"",ports:"22,80,443,9100",timeout:5,concurrent:50})},F=async()=>{if(!B.name||!B.ip){_.oR.error("请填写主机名称和IP地址");return}try{let e=await fetch("/api/hosts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"add-manual",host:{name:B.name,ip:B.ip,sshPort:B.sshPort,sshUser:B.sshUser,sshPassword:B.sshPassword,sshKey:B.sshKey}})}),s=await e.json();s.success?(v(e=>[...e,s.host]),R(!1),P({name:"",ip:"",sshPort:22,sshUser:"",sshPassword:"",sshKey:""}),_.oR.success("主机添加成功")):_.oR.error("主机添加失败")}catch(e){_.oR.error("主机添加失败")}},$=async e=>{try{let s=await fetch("/api/hosts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"test-ssh",hostId:e.id})}),a=await s.json();a.success&&(v(s=>s.map(s=>s.id===e.id?{...s,sshConnectable:a.connectable}:s)),_.oR.success(a.connectable?"SSH连接成功":"SSH连接失败"))}catch(e){_.oR.error("SSH连接测试失败")}},W=e=>{let s=new Set(N);s.has(e)?s.delete(e):s.add(e),y(s)},q=e=>{switch(e){case"online":return(0,t.jsx)(f.A,{className:"h-4 w-4 text-green-500"});case"offline":return(0,t.jsx)(U.A,{className:"h-4 w-4 text-red-500"});default:return(0,t.jsx)(V.A,{className:"h-4 w-4 text-gray-500"})}},G=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"running":return"bg-blue-100 text-blue-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/hosts"),s=await e.json();s.success&&v(s.hosts||[])}catch(e){}})()},[]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"远程主机发现与连接"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"发现网络中的主机并建立连接，为监控组件部署做准备"})]}),(0,t.jsx)(r.$,{variant:"outline",onClick:a,children:"返回"})]}),(0,t.jsxs)(d.tU,{value:m,onValueChange:h,children:[(0,t.jsxs)(d.j7,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(d.Xi,{value:"discover",children:"主机发现"}),(0,t.jsx)(d.Xi,{value:"hosts",children:"发现的主机"}),(0,t.jsx)(d.Xi,{value:"manual",children:"手动添加"})]}),(0,t.jsxs)(d.av,{value:"discover",className:"space-y-4",children:[(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-5 w-5"}),"网络扫描发现"]}),(0,t.jsx)(l.BT,{children:"扫描指定网络范围，自动发现在线主机"})]}),(0,t.jsxs)(l.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"task-name",children:"任务名称"}),(0,t.jsx)(k.p,{id:"task-name",placeholder:"例如：数据中心扫描",value:T.name,onChange:e=>H(s=>({...s,name:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"ip-range",children:"IP范围"}),(0,t.jsx)(k.p,{id:"ip-range",placeholder:"例如：192.168.1.0/24 或 10.0.0.1-10.0.0.100",value:T.ipRange,onChange:e=>H(s=>({...s,ipRange:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"ports",children:"扫描端口"}),(0,t.jsx)(k.p,{id:"ports",placeholder:"例如：22,80,443,9100",value:T.ports,onChange:e=>H(s=>({...s,ports:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"timeout",children:"超时时间(秒)"}),(0,t.jsx)(k.p,{id:"timeout",type:"number",value:T.timeout,onChange:e=>H(s=>({...s,timeout:parseInt(e.target.value)}))})]})]}),(0,t.jsx)(r.$,{onClick:Z,disabled:w,className:"w-full",children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"发现中..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.A,{className:"mr-2 h-4 w-4"}),"开始发现"]})})]})]}),j.length>0&&(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsx)(l.ZB,{children:"发现任务"})}),(0,t.jsx)(l.Wu,{children:(0,t.jsx)("div",{className:"space-y-4",children:j.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.name}),(0,t.jsx)(i.E,{className:G(e.status),children:"running"===e.status?"运行中":"completed"===e.status?"已完成":"failed"===e.status?"失败":"等待中"})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mb-2",children:["IP范围: ",e.ipRange," | 端口: ",e.ports]}),"running"===e.status&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o.k,{value:e.progress}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["进度: ",e.progress,"% | 发现: ",e.foundHosts," 台 | 在线: ",e.onlineHosts," 台"]})]}),"completed"===e.status&&(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["完成时间: ",e.completedAt," | 发现: ",e.foundHosts," 台主机"]})]},e.id))})})]})]}),(0,t.jsx)(d.av,{value:"hosts",className:"space-y-4",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)(l.ZB,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5"}),"发现的主机 (",g.length,")"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(A.S,{checked:N.size===g.length&&g.length>0,onCheckedChange:()=>{N.size===g.length?y(new Set):y(new Set(g.map(e=>e.id)))}}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["已选择 ",N.size," / ",g.length]})]})]})}),(0,t.jsx)(l.Wu,{children:0===g.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(x.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"暂无发现的主机"}),(0,t.jsx)("p",{className:"text-sm",children:"请先进行网络扫描或手动添加主机"})]}):(0,t.jsx)("div",{className:"border rounded-lg",children:(0,t.jsxs)(E.XI,{children:[(0,t.jsx)(E.A0,{children:(0,t.jsxs)(E.Hj,{children:[(0,t.jsx)(E.nd,{className:"w-12"}),(0,t.jsx)(E.nd,{children:"主机信息"}),(0,t.jsx)(E.nd,{children:"系统信息"}),(0,t.jsx)(E.nd,{children:"资源配置"}),(0,t.jsx)(E.nd,{children:"状态"}),(0,t.jsx)(E.nd,{children:"SSH连接"}),(0,t.jsx)(E.nd,{children:"操作"})]})}),(0,t.jsx)(E.BF,{children:g.map(e=>(0,t.jsxs)(E.Hj,{children:[(0,t.jsx)(E.nA,{children:(0,t.jsx)(A.S,{checked:N.has(e.id),onCheckedChange:()=>W(e.id)})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:e.ip}),e.hostname&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.hostname})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-sm",children:[e.os," ",e.osVersion]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.arch})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(O.A,{className:"h-3 w-3"}),e.cpuCores," 核"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(D.A,{className:"h-3 w-3"}),Math.round(e.memory/1024)," GB"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,t.jsx)(L.A,{className:"h-3 w-3"}),e.disk," GB"]})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[q(e.status),(0,t.jsx)("span",{className:"text-sm",children:"online"===e.status?"在线":"offline"===e.status?"离线":"未知"})]})}),(0,t.jsx)(E.nA,{children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:e.sshConnectable?(0,t.jsxs)(i.E,{variant:"default",className:"bg-green-100 text-green-800",children:[(0,t.jsx)(f.A,{className:"h-3 w-3 mr-1"}),"可连接"]}):(0,t.jsxs)(i.E,{variant:"secondary",className:"bg-red-100 text-red-800",children:[(0,t.jsx)(U.A,{className:"h-3 w-3 mr-1"}),"无法连接"]})})}),(0,t.jsx)(E.nA,{children:(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>$(e),children:[(0,t.jsx)(I.A,{className:"h-3 w-3 mr-1"}),"测试SSH"]})})]},e.id))})]})})})]})}),(0,t.jsx)(d.av,{value:"manual",className:"space-y-4",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(K.A,{className:"h-5 w-5"}),"手动添加主机"]}),(0,t.jsx)(l.BT,{children:"手动添加已知的远程主机，配置SSH连接信息"})]}),(0,t.jsxs)(l.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-name",children:"主机名称"}),(0,t.jsx)(k.p,{id:"manual-name",placeholder:"例如：web-server-01",value:B.name,onChange:e=>P(s=>({...s,name:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-ip",children:"IP地址"}),(0,t.jsx)(k.p,{id:"manual-ip",placeholder:"例如：192.168.1.10",value:B.ip,onChange:e=>P(s=>({...s,ip:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-ssh-port",children:"SSH端口"}),(0,t.jsx)(k.p,{id:"manual-ssh-port",type:"number",value:B.sshPort,onChange:e=>P(s=>({...s,sshPort:parseInt(e.target.value)}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-ssh-user",children:"SSH用户名"}),(0,t.jsx)(k.p,{id:"manual-ssh-user",placeholder:"例如：root",value:B.sshUser,onChange:e=>P(s=>({...s,sshUser:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-ssh-password",children:"SSH密码"}),(0,t.jsx)(k.p,{id:"manual-ssh-password",type:"password",placeholder:"SSH密码（可选）",value:B.sshPassword,onChange:e=>P(s=>({...s,sshPassword:e.target.value}))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(C.J,{htmlFor:"manual-ssh-key",children:"SSH私钥"}),(0,t.jsx)(M.T,{id:"manual-ssh-key",placeholder:"粘贴SSH私钥内容（可选）",value:B.sshKey,onChange:e=>P(s=>({...s,sshKey:e.target.value})),rows:6})]}),(0,t.jsxs)(c.Fc,{children:[(0,t.jsx)(J.A,{className:"h-4 w-4"}),(0,t.jsxs)(c.TN,{children:[(0,t.jsx)("strong",{children:"安全提示："})," SSH密码和私钥将被加密存储。建议使用SSH密钥认证而非密码认证。"]})]}),(0,t.jsxs)(r.$,{onClick:F,className:"w-full",children:[(0,t.jsx)(K.A,{className:"mr-2 h-4 w-4"}),"添加主机"]})]})]})})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(r.$,{variant:"outline",onClick:a,children:"返回上一步"}),(0,t.jsxs)(r.$,{onClick:()=>{s(g.filter(e=>N.has(e.id)))},disabled:0===N.size,className:"flex items-center gap-2",children:["继续部署 (",N.size," 台主机)",(0,t.jsx)(f.A,{className:"h-4 w-4"})]})]})]})}var Q=a(16891),Y=a(1243);let ee=e=>{let{isInstalling:s,components:a,onInstall:d,onCancel:x,onRetry:m}=e,[h,j]=(0,n.useState)([]),[u,g]=(0,n.useState)(null),[v,N]=(0,n.useState)(0),[y,b]=(0,n.useState)([]),[S,A]=(0,n.useState)([]),[k,C]=(0,n.useState)(!1),[R,E]=(0,n.useState)(0),[T,H]=(0,n.useState)(0);(0,n.useEffect)(()=>{if(a.length>0){let e=[{id:"check-environment",name:"环境检查",description:"检查 Docker 和 Docker Compose 是否可用",status:"pending"},{id:"create-network",name:"创建网络",description:"创建监控组件专用网络",status:"pending"},...a.map(e=>({id:"install-".concat(e),name:"安装 ".concat(e),description:"下载并启动 ".concat(e," 服务"),status:"pending"})),{id:"verify-services",name:"验证服务",description:"检查所有服务是否正常运行",status:"pending"}];j(e),E(30*e.length)}},[a]),(0,n.useEffect)(()=>{let e;return s?e=setInterval(()=>{H(e=>e+1)},1e3):H(0),()=>{e&&clearInterval(e)}},[s]),(0,n.useEffect)(()=>{s&&h.length>0&&B()},[s,h.length]);let B=async()=>{for(let e=0;e<h.length;e++){let s=h[e];g(s.id),Z(s.id,"running",{startTime:new Date}),F("开始执行: ".concat(s.name));try{if(await P(s),Z(s.id,"completed",{endTime:new Date}),F("✓ 完成: ".concat(s.name)),N((e+1)/h.length*100),s.id.startsWith("install-")){let e=s.id.replace("install-","");await $(e)}}catch(a){let e=a instanceof Error?a.message:String(a);Z(s.id,"failed",{endTime:new Date,error:e}),F("✗ 失败: ".concat(s.name," - ").concat(e));break}await new Promise(e=>setTimeout(e,1e3))}g(null)},P=async e=>{let s=3e3*Math.random()+1e3;return new Promise((a,t)=>{setTimeout(()=>{.1>Math.random()?t(Error("模拟错误: ".concat(e.name," 执行失败"))):a()},s)})},Z=(e,s,a)=>{j(t=>t.map(t=>t.id===e?{...t,status:s,...a}:t))},F=e=>{let s=new Date().toLocaleTimeString();b(a=>[...a,"[".concat(s,"] ").concat(e)])},$=async e=>{let s={name:e,status:Math.random()>.2?"running":"error",containerId:"mock-".concat(e,"-").concat(Math.random().toString(36).substr(2,9)),ports:z(e),uptime:"刚刚启动",health:Math.random()>.1?"healthy":"unhealthy"};A(a=>{let t=a.findIndex(s=>s.name===e);if(!(t>=0))return[...a,s];{let e=[...a];return e[t]=s,e}})},z=e=>({"node-exporter":["9100:9100"],categraf:["9100:9100"],vmagent:["8429:8429"],victoriametrics:["8428:8428"],grafana:["3000:3000"],alertmanager:["9093:9093"],"snmp-exporter":["9116:9116"]})[e]||[],O=e=>{switch(e){case"completed":return(0,t.jsx)(f.A,{className:"h-5 w-5 text-green-500"});case"failed":return(0,t.jsx)(U.A,{className:"h-5 w-5 text-red-500"});case"running":return(0,t.jsx)(p.A,{className:"h-5 w-5 text-blue-500 animate-spin"});case"skipped":return(0,t.jsx)(V.A,{className:"h-5 w-5 text-gray-400"});default:return(0,t.jsx)(V.A,{className:"h-5 w-5 text-gray-300"})}},D=e=>{switch(e){case"running":return(0,t.jsx)(i.E,{className:"bg-green-100 text-green-800",children:"运行中"});case"stopped":return(0,t.jsx)(i.E,{className:"bg-gray-100 text-gray-800",children:"已停止"});case"error":return(0,t.jsx)(i.E,{className:"bg-red-100 text-red-800",children:"错误"});default:return(0,t.jsx)(i.E,{className:"bg-yellow-100 text-yellow-800",children:"未知"})}},L=e=>{switch(e){case"healthy":return(0,t.jsx)(i.E,{variant:"outline",className:"text-green-600 border-green-600",children:"健康"});case"unhealthy":return(0,t.jsx)(i.E,{variant:"outline",className:"text-red-600 border-red-600",children:"不健康"});default:return(0,t.jsx)(i.E,{variant:"outline",className:"text-gray-600 border-gray-600",children:"未知"})}},J=e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))},W=h.filter(e=>"completed"===e.status).length,q=h.filter(e=>"failed"===e.status).length>0,M=W===h.length&&!q;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.ZB,{children:"安装进度"}),(0,t.jsx)(l.BT,{children:s?"正在安装监控组件...":M?"安装完成！":q?"安装遇到错误":"准备开始安装"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[Math.round(v),"%"]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:s?"已用时: ".concat(J(T)):R>0?"预计: ".concat(J(R)):""})]})]})}),(0,t.jsxs)(l.Wu,{children:[(0,t.jsx)(o.k,{value:v,className:"mb-4"}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,t.jsxs)("span",{children:[W," / ",h.length," 步骤完成"]}),(0,t.jsxs)("span",{children:[a.length," 个组件"]})]}),q&&(0,t.jsxs)(c.Fc,{className:"mt-4",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4"}),(0,t.jsx)(c.TN,{children:"安装过程中遇到错误，请检查日志并重试。"})]})]})]}),(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsx)(l.ZB,{children:"安装步骤"})}),(0,t.jsx)(l.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:h.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-lg transition-colors ".concat("running"===e.status?"bg-blue-50 border border-blue-200":"completed"===e.status?"bg-green-50":"failed"===e.status?"bg-red-50":"bg-gray-50"),children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:O(e.status)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),"running"===e.status&&(0,t.jsx)(i.E,{variant:"outline",className:"text-blue-600 border-blue-600",children:"进行中"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),e.error&&(0,t.jsxs)("p",{className:"text-sm text-red-600 mt-1",children:["错误: ",e.error]})]}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.startTime&&e.endTime&&(0,t.jsxs)("span",{children:[Math.round((e.endTime.getTime()-e.startTime.getTime())/1e3),"s"]})})]},e.id))})})]}),S.length>0&&(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsx)(l.ZB,{children:"服务状态"})}),(0,t.jsx)(l.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:S.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),D(e.status),e.health&&L(e.health)]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.ports&&e.ports.length>0&&(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)("span",{children:"端口:"}),e.ports.map((e,s)=>(0,t.jsx)(i.E,{variant:"outline",className:"text-xs",children:e},s))]}),e.uptime&&(0,t.jsxs)("span",{children:["运行时间: ",e.uptime]}),e.containerId&&(0,t.jsx)("span",{className:"font-mono text-xs",children:e.containerId.substring(0,12)})]})]},e.name))})})]}),(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(l.ZB,{children:"安装日志"}),(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>C(!k),children:[(0,t.jsx)(I.A,{className:"h-4 w-4 mr-1"}),k?"隐藏":"显示","日志"]})]})}),k&&(0,t.jsx)(l.Wu,{children:(0,t.jsx)(Q.F,{className:"h-64 w-full border rounded-lg p-3",children:(0,t.jsxs)("div",{className:"space-y-1 font-mono text-sm",children:[y.map((e,s)=>(0,t.jsx)("div",{className:"text-gray-700",children:e},s)),0===y.length&&(0,t.jsx)("div",{className:"text-gray-500 text-center py-8",children:"暂无日志输出"})]})})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[!s&&!M&&(0,t.jsxs)(r.$,{onClick:d,className:"px-8",children:[(0,t.jsx)(X.A,{className:"h-4 w-4 mr-2"}),"开始安装"]}),s&&(0,t.jsxs)(r.$,{variant:"outline",onClick:x,children:[(0,t.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"取消安装"]}),q&&(0,t.jsxs)(r.$,{onClick:m,variant:"outline",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"重试安装"]}),M&&(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-green-600",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"font-medium",children:"安装完成！"})]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"所有组件已成功安装并运行"})]})]})]})},es=b.q,ea=e=>{switch(e){case"collector":return x.A;case"storage":return m.A;case"visualization":return h.A;case"alerting":return j.A;default:return u.A}};function et(){var e,s;let[a,m]=(0,n.useState)("select"),[h,j]=(0,n.useState)(!1),[b,A]=(0,n.useState)(0),[k,C]=(0,n.useState)([]),[R,E]=(0,n.useState)([]),[T,H]=(0,n.useState)("binary"),[B,P]=(0,n.useState)({}),[Z,I]=(0,n.useState)(null),[F,$]=(0,n.useState)({}),z=Object.values(es).map(e=>{let s=e.versions.find(e=>e.isLatest)||e.versions[0];return{id:e.id,name:e.name,description:e.description,icon:ea(e.category),status:"available",version:s?s.version:"N/A",category:e.category,features:e.features,requirements:e.requirements}}),O=e=>{let s=es[e];if(!s)return"";let a=s.versions.find(e=>e.isLatest)||s.versions[0];return"version: '3.8'\nservices:\n  ".concat(e,":\n    image: ").concat(D(e,a.version),"\n    container_name: ").concat(e,'\n    ports:\n      - "').concat(s.defaultPort,":").concat(s.defaultPort,'"\n    networks:\n      - monitoring\n    restart: unless-stopped\n\nnetworks:\n  monitoring:\n    external: true\n')},D=(e,s)=>({"node-exporter":"prom/node-exporter:v".concat(s),categraf:"flashcatcloud/categraf:v".concat(s),vmagent:"victoriametrics/vmagent:v".concat(s),victoriametrics:"victoriametrics/victoria-metrics:v".concat(s),vmstorage:"victoriametrics/vmstorage:v".concat(s),vminsert:"victoriametrics/vminsert:v".concat(s),vmselect:"victoriametrics/vmselect:v".concat(s),vmalert:"victoriametrics/vmalert:v".concat(s),grafana:"grafana/grafana:".concat(s),"snmp-exporter":"prom/snmp-exporter:v".concat(s),alertmanager:"prom/alertmanager:v".concat(s)})[e]||"".concat(e,":").concat(s),L=(e,s)=>{E(e),H(s),m("config")},J=()=>{"hosts"===a?m("select"):"config"===a?m("hosts"):"install"===a&&m("config")},W=async()=>{if(0===k.length||0===R.length){alert("请选择组件和目标主机");return}j(!0),A(0);try{let e={};k.forEach(s=>{e["docker-compose.".concat(s,".yml")]=O(s)});let s=await fetch("/api/monitoring/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"install",components:k,hosts:R,configs:e})});if((await s.json()).success){let e=setInterval(()=>{A(s=>s>=100?(clearInterval(e),j(!1),M(),100):s+5)},1e3)}else j(!1)}catch(e){j(!1)}},M=async()=>{try{let e=Object.keys(es),s=await fetch("/api/monitoring/install",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"status",components:e})}),a=await s.json();if(a.success&&a.statuses){let e={};a.statuses.forEach(s=>{e[s.name]=s.status}),P(e)}}catch(e){}},U=async()=>{try{let e=await fetch("/api/monitoring/install"),s=await e.json();I(s)}catch(e){}},V=(e,s)=>{s?C(s=>[...s,e]):C(s=>s.filter(s=>s!==e))};return n.useEffect(()=>{U(),M()},[]),(0,t.jsxs)("div",{className:"flex-1 space-y-6 p-4 md:p-8 pt-6",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-4 lg:flex-row lg:items-center lg:justify-between lg:space-y-0",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600",children:(0,t.jsx)(g.A,{className:"h-4 w-4 text-white"})}),(0,t.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Monitoring Component Installer"})]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"One-click installation and configuration of monitoring components to quickly build a complete monitoring system"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:M,children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4"}),"刷新状态"]}),"select"===a&&(0,t.jsxs)(r.$,{size:"sm",onClick:()=>{if(0===k.length){alert("请至少选择一个组件");return}m("hosts")},disabled:0===k.length,children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4"}),"下一步: 选择主机 (",k.length,")"]}),"hosts"===a&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(r.$,{variant:"outline",size:"sm",onClick:J,children:"返回"}),(0,t.jsxs)(r.$,{size:"sm",onClick:()=>m("config"),disabled:0===R.length,children:["下一步: 配置确认 (",R.length," 主机)"]})]}),"config"===a&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(r.$,{variant:"outline",size:"sm",onClick:J,children:"返回"}),(0,t.jsx)(r.$,{size:"sm",onClick:()=>{m("install"),W()},disabled:h,children:"开始安装"})]}),"install"===a&&(0,t.jsx)(r.$,{variant:"outline",size:"sm",onClick:J,disabled:h,children:"返回配置"})]})]}),h&&(0,t.jsxs)(c.Fc,{children:[(0,t.jsx)(v.A,{className:"h-4 w-4"}),(0,t.jsxs)(c.TN,{children:["Installing components... ",b,"%",(0,t.jsx)(o.k,{value:b,className:"mt-2"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4 mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat("select"===a?"text-blue-600":"hosts"===a||"config"===a||"install"===a?"text-green-600":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("select"===a?"bg-blue-600 text-white":"hosts"===a||"config"===a||"install"===a?"bg-green-600 text-white":"bg-gray-200"),children:"1"}),(0,t.jsx)("span",{className:"font-medium",children:"选择组件"})]}),(0,t.jsx)("div",{className:"w-8 h-0.5 ".concat("hosts"===a||"config"===a||"install"===a?"bg-green-600":"bg-gray-200")}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat("hosts"===a?"text-blue-600":"config"===a||"install"===a?"text-green-600":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("hosts"===a?"bg-blue-600 text-white":"config"===a||"install"===a?"bg-green-600 text-white":"bg-gray-200"),children:"2"}),(0,t.jsx)("span",{className:"font-medium",children:"选择主机"})]}),(0,t.jsx)("div",{className:"w-8 h-0.5 ".concat("config"===a||"install"===a?"bg-green-600":"bg-gray-200")}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat("config"===a?"text-blue-600":"install"===a?"text-green-600":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("config"===a?"bg-blue-600 text-white":"install"===a?"bg-green-600 text-white":"bg-gray-200"),children:"3"}),(0,t.jsx)("span",{className:"font-medium",children:"配置确认"})]}),(0,t.jsx)("div",{className:"w-8 h-0.5 ".concat("install"===a?"bg-green-600":"bg-gray-200")}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat("install"===a?"text-blue-600":"text-gray-400"),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("install"===a?"bg-blue-600 text-white":"bg-gray-200"),children:"4"}),(0,t.jsx)("span",{className:"font-medium",children:"执行安装"})]})]}),"select"===a&&(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsx)(l.ZB,{children:"选择监控组件"}),(0,t.jsx)(l.BT,{children:"选择需要安装的监控组件，支持多选"})]}),(0,t.jsx)(l.Wu,{children:(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[" ",z.map(e=>{let s=e.icon,a=k.includes(e.id),n=B[e.id]||"unknown",r="running"===n?"text-green-600":"stopped"===n?"text-red-600":"error"===n?"text-red-600":"text-gray-600",c="running"===n?f.A:"stopped"===n?N.A:"error"===n?N.A:u.A;return(0,t.jsxs)(l.Zp,{className:a?"ring-2 ring-blue-500":"",children:[(0,t.jsxs)(l.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("button",{onClick:()=>V(e.id,!a),className:"flex items-center space-x-2",children:a?(0,t.jsx)(y.A,{className:"h-4 w-4 text-blue-500"}):(0,t.jsx)(w.A,{className:"h-4 w-4 text-gray-400"})}),(0,t.jsx)(s,{className:"h-5 w-5"}),(0,t.jsx)(l.ZB,{className:"text-lg",children:e.name})]}),(0,t.jsxs)(i.E,{variant:"secondary",children:["v",e.version]})]}),(0,t.jsxs)(l.Wu,{children:[(0,t.jsx)(l.BT,{className:"mb-4 h-10",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c,{className:"h-4 w-4 ".concat(r)}),(0,t.jsx)("span",{className:"text-sm ".concat(r),children:"running"===n?"运行中":"stopped"===n?"已停止":"error"===n?"错误":"未知"})]}),(0,t.jsx)(i.E,{variant:a?"default":"secondary",children:a?"已选择":"点击选择"})]})]})]},e.id)})]})})]})}),"hosts"===a&&(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsx)(l.ZB,{children:"选择主机获取方式"}),(0,t.jsx)(l.BT,{children:"选择如何获取要部署监控组件的目标主机"})]}),(0,t.jsx)(l.Wu,{children:(0,t.jsxs)(d.tU,{defaultValue:"discover",className:"w-full",children:[(0,t.jsxs)(d.j7,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(d.Xi,{value:"discover",children:"发现远程主机"}),(0,t.jsx)(d.Xi,{value:"existing",children:"使用现有主机"})]}),(0,t.jsx)(d.av,{value:"discover",className:"mt-6",children:(0,t.jsx)(G,{onHostsSelected:e=>L(e,"binary"),onBack:J})}),(0,t.jsx)(d.av,{value:"existing",className:"mt-6",children:1===k.length?(0,t.jsx)(q,{selectedComponent:{id:k[0],name:(null===(e=es[k[0]])||void 0===e?void 0:e.name)||k[0],category:(null===(s=es[k[0]])||void 0===s?void 0:s.category)||"unknown"},onHostsSelected:L,onBack:J}):(0,t.jsx)(S.W,{selectedComponents:k,onHostsSelected:e=>L(e,"docker"),onBack:J})})]})})]})}),"config"===a&&(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(l.Zp,{children:[(0,t.jsxs)(l.aR,{children:[(0,t.jsx)(l.ZB,{children:"配置确认"}),(0,t.jsx)(l.BT,{children:"确认安装配置和部署参数"})]}),(0,t.jsx)(l.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium mb-2",children:["选中的组件 (",k.length,")"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map(e=>{let s=es[e];return(0,t.jsx)(i.E,{variant:"outline",children:(null==s?void 0:s.name)||e},e)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium mb-2",children:"部署方式"}),(0,t.jsx)(i.E,{variant:"default",children:"binary"===T?"二进制部署":"docker"===T?"Docker容器":"systemd"===T?"Systemd服务":"package"===T?"包管理器":T})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium mb-2",children:["目标主机 (",R.length,")"]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:R.map((e,s)=>(0,t.jsxs)(i.E,{variant:"outline",children:[e.name||e.id||"主机".concat(s+1)," (",e.ip||"N/A",")"]},e.id||s))})]})]})})]})}),"install"===a&&(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(ee,{isInstalling:h,components:k,onInstall:W,onCancel:()=>m("config")})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[8096,1592,5066,7358],()=>s(44109)),_N_E=e.O()}]);