"use client"

import { useState } from "react"
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Badge } from "@/components/ui/badge"
import { Separator } from "@/components/ui/separator"
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog"
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table"
import { Checkbox } from "@/components/ui/checkbox"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Plus, Search, Filter, Copy, Edit, Trash2, Target, Download, Upload, Star, StarOff, Cpu, HardDrive, Thermometer, Wifi, Activity, AlertTriangle } from "lucide-react"
import { toast } from "sonner"
import { PromQLEditor } from "./promql-editor"

// Ê®°ÊùøÂàÜÁ±ª
const TEMPLATE_CATEGORIES = [
  { value: "huawei", label: "Âçé‰∏∫", icon: "üî∂" },
  { value: "cisco", label: "ÊÄùÁßë", icon: "üîµ" },
  { value: "h3c", label: "H3C", icon: "üü¢" },
  { value: "juniper", label: "ÁûªÂçö", icon: "üü°" },
  { value: "generic", label: "ÈÄöÁî®", icon: "‚ö™" }
]

const TEMPLATE_TYPES = [
  { value: "cpu", label: "CPU", icon: Cpu },
  { value: "memory", label: "ÂÜÖÂ≠ò", icon: HardDrive },
  { value: "temperature", label: "Ê∏©Â∫¶", icon: Thermometer },
  { value: "interface", label: "Êé•Âè£", icon: Wifi },
  { value: "performance", label: "ÊÄßËÉΩ", icon: Activity },
  { value: "availability", label: "ÂèØÁî®ÊÄß", icon: AlertTriangle }
]

const DEVICE_LEVELS = [
  { value: "core", label: "Ê†∏ÂøÉ" },
  { value: "aggregation", label: "Ê±áËÅö" },
  { value: "access", label: "Êé•ÂÖ•" }
]

// Ê®°ÊãüÊ®°ÊùøÊï∞ÊçÆ
const mockTemplates = [
  {
    id: "1",
    name: "Âçé‰∏∫‰∫§Êç¢Êú∫CPUÁõëÊéß",
    description: "ÁõëÊéßÂçé‰∏∫‰∫§Êç¢Êú∫CPU‰ΩøÁî®ÁéáÔºåÊîØÊåÅSÁ≥ªÂàó‰∫§Êç¢Êú∫",
    category: "huawei",
    type: "cpu",
    level: "core",
    promql: "(hwCpuDevCpuUsage{job=\"snmp\", vendor=\"huawei\"} > {{threshold}})",
    defaultThreshold: 80,
    severity: "warning",
    duration: "5m",
    variables: [
      { name: "threshold", description: "CPU‰ΩøÁî®ÁéáÈòàÂÄº", defaultValue: "80", type: "number" }
    ],
    tags: ["Âçé‰∏∫", "CPU", "ÊÄßËÉΩ"],
    isStarred: true,
    usageCount: 25,
    createdAt: "2024-01-10",
    updatedAt: "2024-01-15"
  },
  {
    id: "2",
    name: "ÊÄùÁßë‰∫§Êç¢Êú∫ÂÜÖÂ≠òÁõëÊéß",
    description: "ÁõëÊéßÊÄùÁßë‰∫§Êç¢Êú∫ÂÜÖÂ≠ò‰ΩøÁî®ÁéáÔºåÈÄÇÁî®‰∫éCatalystÁ≥ªÂàó",
    category: "cisco",
    type: "memory",
    level: "aggregation",
    promql: "((ciscoMemoryPoolUsed{job=\"snmp\", vendor=\"cisco\"} / (ciscoMemoryPoolUsed + ciscoMemoryPoolFree)) * 100 > {{threshold}})",
    defaultThreshold: 85,
    severity: "warning",
    duration: "3m",
    variables: [
      { name: "threshold", description: "ÂÜÖÂ≠ò‰ΩøÁî®ÁéáÈòàÂÄº", defaultValue: "85", type: "number" }
    ],
    tags: ["ÊÄùÁßë", "ÂÜÖÂ≠ò", "ÊÄßËÉΩ"],
    isStarred: false,
    usageCount: 18,
    createdAt: "2024-01-08",
    updatedAt: "2024-01-12"
  },
  {
    id: "3",
    name: "ÈÄöÁî®Êé•Âè£ÊµÅÈáèÁõëÊéß",
    description: "ÁõëÊéßÁΩëÁªúÊé•Âè£ÊµÅÈáèÔºåÈÄÇÁî®‰∫éÊâÄÊúâÊîØÊåÅSNMPÁöÑËÆæÂ§á",
    category: "generic",
    type: "interface",
    level: "access",
    promql: "(rate(ifInOctets{job=\"snmp\"}[5m]) * 8 / 1024 / 1024 > {{threshold}})",
    defaultThreshold: 100,
    severity: "warning",
    duration: "2m",
    variables: [
      { name: "threshold", description: "ÊµÅÈáèÈòàÂÄº(Mbps)", defaultValue: "100", type: "number" }
    ],
    tags: ["ÈÄöÁî®", "Êé•Âè£", "ÊµÅÈáè"],
    isStarred: true,
    usageCount: 42,
    createdAt: "2024-01-05",
    updatedAt: "2024-01-14"
  },
  {
    id: "4",
    name: "ËÆæÂ§áÊ∏©Â∫¶ÂëäË≠¶",
    description: "ÁõëÊéßËÆæÂ§áÊ∏©Â∫¶‰º†ÊÑüÂô®ÔºåÈò≤Ê≠¢ËøáÁÉ≠",
    category: "generic",
    type: "temperature",
    level: "core",
    promql: "(entPhySensorValue{entPhySensorType=\"8\", job=\"snmp\"} > {{threshold}})",
    defaultThreshold: 70,
    severity: "critical",
    duration: "1m",
    variables: [
      { name: "threshold", description: "Ê∏©Â∫¶ÈòàÂÄº(¬∞C)", defaultValue: "70", type: "number" }
    ],
    tags: ["ÈÄöÁî®", "Ê∏©Â∫¶", "Á°¨‰ª∂"],
    isStarred: false,
    usageCount: 12,
    createdAt: "2024-01-12",
    updatedAt: "2024-01-13"
  }
]

interface RuleTemplateManagerProps {
  onApplyTemplate?: (template: any, deviceGroups: string[]) => void
}

export function RuleTemplateManager({ onApplyTemplate }: RuleTemplateManagerProps) {
  const [templates, setTemplates] = useState(mockTemplates)
  const [selectedTemplates, setSelectedTemplates] = useState<string[]>([])
  const [searchTerm, setSearchTerm] = useState("")
  const [filterCategory, setFilterCategory] = useState("all")
  const [filterType, setFilterType] = useState("all")
  const [filterLevel, setFilterLevel] = useState("all")
  const [showStarredOnly, setShowStarredOnly] = useState(false)
  const [showTemplateEditor, setShowTemplateEditor] = useState(false)
  const [editingTemplate, setEditingTemplate] = useState<any>(null)
  const [showApplyDialog, setShowApplyDialog] = useState(false)
  const [selectedTemplate, setSelectedTemplate] = useState<any>(null)
  const [promqlCode, setPromqlCode] = useState("")
  const [templateVariables, setTemplateVariables] = useState<any[]>([])

  // ËøáÊª§Ê®°Êùø
  const filteredTemplates = templates.filter(template => {
    const matchesSearch = template.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         template.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         template.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
    const matchesCategory = filterCategory === "all" || template.category === filterCategory
    const matchesType = filterType === "all" || template.type === filterType
    const matchesLevel = filterLevel === "all" || template.level === filterLevel
    const matchesStarred = !showStarredOnly || template.isStarred
    
    return matchesSearch && matchesCategory && matchesType && matchesLevel && matchesStarred
  })

  // ÂàáÊç¢Êî∂ËóèÁä∂ÊÄÅ
  const toggleStar = (templateId: string) => {
    setTemplates(prev => prev.map(template => 
      template.id === templateId 
        ? { ...template, isStarred: !template.isStarred }
        : template
    ))
  }

  // Â§çÂà∂Ê®°Êùø
  const duplicateTemplate = (template: any) => {
    const newTemplate = {
      ...template,
      id: Date.now().toString(),
      name: `${template.name} (ÂâØÊú¨)`,
      usageCount: 0,
      createdAt: new Date().toISOString().split('T')[0],
      updatedAt: new Date().toISOString().split('T')[0]
    }
    setTemplates(prev => [newTemplate, ...prev])
    toast.success("Ê®°ÊùøÂ§çÂà∂ÊàêÂäü")
  }

  // Âà†Èô§Ê®°Êùø
  const deleteTemplate = (templateId: string) => {
    setTemplates(prev => prev.filter(t => t.id !== templateId))
    toast.success("Ê®°ÊùøÂà†Èô§ÊàêÂäü")
  }

  // ÊâπÈáèÊìç‰Ωú
  const handleBatchOperation = (operation: string) => {
    if (selectedTemplates.length === 0) {
      toast.error("ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÊìç‰ΩúÁöÑÊ®°Êùø")
      return
    }
    
    switch (operation) {
      case "star":
        setTemplates(prev => prev.map(template => 
          selectedTemplates.includes(template.id)
            ? { ...template, isStarred: true }
            : template
        ))
        toast.success(`Â∑≤Êî∂Ëóè ${selectedTemplates.length} ‰∏™Ê®°Êùø`)
        break
      case "unstar":
        setTemplates(prev => prev.map(template => 
          selectedTemplates.includes(template.id)
            ? { ...template, isStarred: false }
            : template
        ))
        toast.success(`Â∑≤ÂèñÊ∂àÊî∂Ëóè ${selectedTemplates.length} ‰∏™Ê®°Êùø`)
        break
      case "delete":
        setTemplates(prev => prev.filter(t => !selectedTemplates.includes(t.id)))
        toast.success(`Â∑≤Âà†Èô§ ${selectedTemplates.length} ‰∏™Ê®°Êùø`)
        break
      case "export":
        toast.success(`Â∑≤ÂØºÂá∫ ${selectedTemplates.length} ‰∏™Ê®°Êùø`)
        break
    }
    setSelectedTemplates([])
  }

  // ÊâìÂºÄÊ®°ÊùøÁºñËæëÂô®
  const openTemplateEditor = (template?: any) => {
    setEditingTemplate(template)
    setPromqlCode(template?.promql || "")
    setTemplateVariables(template?.variables || [])
    setShowTemplateEditor(true)
  }

  // ‰øùÂ≠òÊ®°Êùø
  const saveTemplate = (templateData: any) => {
    if (editingTemplate) {
      // Êõ¥Êñ∞Áé∞ÊúâÊ®°Êùø
      setTemplates(prev => prev.map(t => 
        t.id === editingTemplate.id 
          ? { ...t, ...templateData, updatedAt: new Date().toISOString().split('T')[0] }
          : t
      ))
      toast.success("Ê®°ÊùøÊõ¥Êñ∞ÊàêÂäü")
    } else {
      // ÂàõÂª∫Êñ∞Ê®°Êùø
      const newTemplate = {
        ...templateData,
        id: Date.now().toString(),
        usageCount: 0,
        isStarred: false,
        createdAt: new Date().toISOString().split('T')[0],
        updatedAt: new Date().toISOString().split('T')[0]
      }
      setTemplates(prev => [newTemplate, ...prev])
      toast.success("Ê®°ÊùøÂàõÂª∫ÊàêÂäü")
    }
    setShowTemplateEditor(false)
    setEditingTemplate(null)
  }

  // Â∫îÁî®Ê®°Êùø
  const applyTemplate = (template: any) => {
    setSelectedTemplate(template)
    setShowApplyDialog(true)
  }

  return (
    <div className="space-y-4">
      {/* Â∑•ÂÖ∑Ê†è */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-4">
          <div className="relative">
            <Search className="absolute left-2 top-2.5 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="ÊêúÁ¥¢Ê®°Êùø..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-8 w-64"
            />
          </div>
          <Select value={filterCategory} onValueChange={setFilterCategory}>
            <SelectTrigger className="w-32">
              <SelectValue placeholder="ÂéÇÂïÜ" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">ÂÖ®ÈÉ®ÂéÇÂïÜ</SelectItem>
              {TEMPLATE_CATEGORIES.map(cat => (
                <SelectItem key={cat.value} value={cat.value}>
                  {cat.icon} {cat.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          <Select value={filterType} onValueChange={setFilterType}>
            <SelectTrigger className="w-32">
              <SelectValue placeholder="Á±ªÂûã" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">ÂÖ®ÈÉ®Á±ªÂûã</SelectItem>
              {TEMPLATE_TYPES.map(type => {
                const Icon = type.icon
                return (
                  <SelectItem key={type.value} value={type.value}>
                    <div className="flex items-center">
                      <Icon className="mr-2 h-4 w-4" />
                      {type.label}
                    </div>
                  </SelectItem>
                )
              })}
            </SelectContent>
          </Select>
          <Select value={filterLevel} onValueChange={setFilterLevel}>
            <SelectTrigger className="w-32">
              <SelectValue placeholder="Á∫ßÂà´" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">ÂÖ®ÈÉ®Á∫ßÂà´</SelectItem>
              {DEVICE_LEVELS.map(level => (
                <SelectItem key={level.value} value={level.value}>
                  {level.label}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          <Button
            variant={showStarredOnly ? "default" : "outline"}
            size="sm"
            onClick={() => setShowStarredOnly(!showStarredOnly)}
          >
            <Star className="mr-1 h-3 w-3" />
            Êî∂Ëóè
          </Button>
        </div>
        <div className="flex items-center space-x-2">
          <Button variant="outline" size="sm">
            <Download className="mr-2 h-4 w-4" />
            ÂØºÂá∫
          </Button>
          <Button variant="outline" size="sm">
            <Upload className="mr-2 h-4 w-4" />
            ÂØºÂÖ•
          </Button>
          <Button onClick={() => openTemplateEditor()}>
            <Plus className="mr-2 h-4 w-4" />
            Êñ∞Âª∫Ê®°Êùø
          </Button>
        </div>
      </div>

      {/* ÊâπÈáèÊìç‰Ωú */}
      {selectedTemplates.length > 0 && (
        <div className="flex items-center space-x-2 p-3 bg-muted rounded-lg">
          <span className="text-sm text-muted-foreground">
            Â∑≤ÈÄâÊã© {selectedTemplates.length} ‰∏™Ê®°Êùø
          </span>
          <Separator orientation="vertical" className="h-4" />
          <Button size="sm" variant="outline" onClick={() => handleBatchOperation("star")}>
            <Star className="mr-1 h-3 w-3" />
            ÊâπÈáèÊî∂Ëóè
          </Button>
          <Button size="sm" variant="outline" onClick={() => handleBatchOperation("unstar")}>
            <StarOff className="mr-1 h-3 w-3" />
            ÂèñÊ∂àÊî∂Ëóè
          </Button>
          <Button size="sm" variant="outline" onClick={() => handleBatchOperation("export")}>
            <Download className="mr-1 h-3 w-3" />
            ÊâπÈáèÂØºÂá∫
          </Button>
          <Button size="sm" variant="outline" onClick={() => handleBatchOperation("delete")}>
            <Trash2 className="mr-1 h-3 w-3" />
            ÊâπÈáèÂà†Èô§
          </Button>
        </div>
      )}

      {/* Ê®°ÊùøÁΩëÊ†º */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        {filteredTemplates.map((template) => {
          const categoryInfo = TEMPLATE_CATEGORIES.find(c => c.value === template.category)
          const typeInfo = TEMPLATE_TYPES.find(t => t.value === template.type)
          const TypeIcon = typeInfo?.icon || Activity
          
          return (
            <Card key={template.id} className="relative">
              <CardHeader>
                <div className="flex items-start justify-between">
                  <div className="flex items-center space-x-2">
                    <Checkbox
                      checked={selectedTemplates.includes(template.id)}
                      onCheckedChange={(checked) => {
                        if (checked) {
                          setSelectedTemplates([...selectedTemplates, template.id])
                        } else {
                          setSelectedTemplates(selectedTemplates.filter(id => id !== template.id))
                        }
                      }}
                    />
                    <div className="flex-1">
                      <CardTitle className="text-lg flex items-center space-x-2">
                        <TypeIcon className="h-4 w-4" />
                        <span>{template.name}</span>
                      </CardTitle>
                      <CardDescription>{template.description}</CardDescription>
                    </div>
                  </div>
                  <Button
                    size="sm"
                    variant="ghost"
                    onClick={() => toggleStar(template.id)}
                  >
                    {template.isStarred ? (
                      <Star className="h-4 w-4 fill-yellow-400 text-yellow-400" />
                    ) : (
                      <StarOff className="h-4 w-4" />
                    )}
                  </Button>
                </div>
              </CardHeader>
              <CardContent>
                <div className="space-y-3">
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-muted-foreground">ÂéÇÂïÜ:</span>
                    <Badge variant="outline">
                      {categoryInfo?.icon} {categoryInfo?.label}
                    </Badge>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-muted-foreground">Á±ªÂûã:</span>
                    <Badge variant="secondary">{typeInfo?.label}</Badge>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-muted-foreground">Á∫ßÂà´:</span>
                    <span>{DEVICE_LEVELS.find(l => l.value === template.level)?.label}</span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-muted-foreground">ÈªòËÆ§ÈòàÂÄº:</span>
                    <span>{template.defaultThreshold}{template.type === 'temperature' ? '¬∞C' : '%'}</span>
                  </div>
                  <div className="flex items-center justify-between text-sm">
                    <span className="text-muted-foreground">‰ΩøÁî®Ê¨°Êï∞:</span>
                    <Badge variant="outline">{template.usageCount}</Badge>
                  </div>
                  
                  <div className="flex flex-wrap gap-1">
                    {template.tags.map(tag => (
                      <Badge key={tag} variant="outline" className="text-xs">
                        {tag}
                      </Badge>
                    ))}
                  </div>
                  
                  <Separator />
                  
                  <div className="flex items-center space-x-2">
                    <Button 
                      size="sm" 
                      className="flex-1"
                      onClick={() => applyTemplate(template)}
                    >
                      <Target className="mr-1 h-3 w-3" />
                      Â∫îÁî®
                    </Button>
                    <Button 
                      size="sm" 
                      variant="outline"
                      onClick={() => duplicateTemplate(template)}
                    >
                      <Copy className="h-3 w-3" />
                    </Button>
                    <Button 
                      size="sm" 
                      variant="outline"
                      onClick={() => openTemplateEditor(template)}
                    >
                      <Edit className="h-3 w-3" />
                    </Button>
                    <Button 
                      size="sm" 
                      variant="outline"
                      onClick={() => deleteTemplate(template.id)}
                    >
                      <Trash2 className="h-3 w-3" />
                    </Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          )
        })}
      </div>

      {/* Ê®°ÊùøÁºñËæëÂô®ÂØπËØùÊ°Ü */}
      <Dialog open={showTemplateEditor} onOpenChange={setShowTemplateEditor}>
        <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {editingTemplate ? "ÁºñËæëÊ®°Êùø" : "Êñ∞Âª∫Ê®°Êùø"}
            </DialogTitle>
            <DialogDescription>
              ÂàõÂª∫ÊàñÁºñËæëÂëäË≠¶ËßÑÂàôÊ®°ÊùøÔºåÊîØÊåÅÂèòÈáèÂíåPromQLÁºñËæë
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div>
                <Label>Ê®°ÊùøÂêçÁß∞</Label>
                <Input defaultValue={editingTemplate?.name} placeholder="ËæìÂÖ•Ê®°ÊùøÂêçÁß∞" />
              </div>
              <div>
                <Label>ÂéÇÂïÜÂàÜÁ±ª</Label>
                <Select defaultValue={editingTemplate?.category}>
                  <SelectTrigger>
                    <SelectValue placeholder="ÈÄâÊã©ÂéÇÂïÜ" />
                  </SelectTrigger>
                  <SelectContent>
                    {TEMPLATE_CATEGORIES.map(cat => (
                      <SelectItem key={cat.value} value={cat.value}>
                        {cat.icon} {cat.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            <div>
              <Label>ÊèèËø∞</Label>
              <Textarea defaultValue={editingTemplate?.description} placeholder="ËæìÂÖ•Ê®°ÊùøÊèèËø∞" />
            </div>
            
            <div className="grid grid-cols-3 gap-4">
              <div>
                <Label>ÁõëÊéßÁ±ªÂûã</Label>
                <Select defaultValue={editingTemplate?.type}>
                  <SelectTrigger>
                    <SelectValue placeholder="ÈÄâÊã©Á±ªÂûã" />
                  </SelectTrigger>
                  <SelectContent>
                    {TEMPLATE_TYPES.map(type => {
                      const Icon = type.icon
                      return (
                        <SelectItem key={type.value} value={type.value}>
                          <div className="flex items-center">
                            <Icon className="mr-2 h-4 w-4" />
                            {type.label}
                          </div>
                        </SelectItem>
                      )
                    })}
                  </SelectContent>
                </Select>
              </div>
              <div>
                <Label>ËÆæÂ§áÁ∫ßÂà´</Label>
                <Select defaultValue={editingTemplate?.level}>
                  <SelectTrigger>
                    <SelectValue placeholder="ÈÄâÊã©Á∫ßÂà´" />
                  </SelectTrigger>
                  <SelectContent>
                    {DEVICE_LEVELS.map(level => (
                      <SelectItem key={level.value} value={level.value}>
                        {level.label}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <div>
                <Label>‰∏•ÈáçÁ®ãÂ∫¶</Label>
                <Select defaultValue={editingTemplate?.severity}>
                  <SelectTrigger>
                    <SelectValue placeholder="ÈÄâÊã©‰∏•ÈáçÁ®ãÂ∫¶" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="critical">‰∏•Èáç</SelectItem>
                    <SelectItem value="warning">Ë≠¶Âëä</SelectItem>
                    <SelectItem value="info">‰ø°ÊÅØ</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            <div>
              <Label>PromQLÊü•ËØ¢Ê®°Êùø</Label>
              <PromQLEditor
                value={promqlCode}
                onChange={setPromqlCode}
                placeholder="ËæìÂÖ•PromQLÊü•ËØ¢Ê®°ÊùøÔºå‰ΩøÁî® {{ÂèòÈáèÂêç}} ÂÆö‰πâÂèòÈáè..."
              />
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div>
                <Label>ÈªòËÆ§ÈòàÂÄº</Label>
                <Input type="number" defaultValue={editingTemplate?.defaultThreshold} placeholder="80" />
              </div>
              <div>
                <Label>ÊåÅÁª≠Êó∂Èó¥</Label>
                <Input defaultValue={editingTemplate?.duration} placeholder="5m" />
              </div>
            </div>
            
            <div>
              <Label>Ê†áÁ≠æ</Label>
              <Input placeholder="ËæìÂÖ•Ê†áÁ≠æÔºåÁî®ÈÄóÂè∑ÂàÜÈöî" />
            </div>
            
            <div className="flex items-center justify-end space-x-2">
              <Button variant="outline" onClick={() => setShowTemplateEditor(false)}>
                ÂèñÊ∂à
              </Button>
              <Button onClick={() => saveTemplate({})}>
                {editingTemplate ? "Êõ¥Êñ∞Ê®°Êùø" : "ÂàõÂª∫Ê®°Êùø"}
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>

      {/* Â∫îÁî®Ê®°ÊùøÂØπËØùÊ°Ü */}
      <Dialog open={showApplyDialog} onOpenChange={setShowApplyDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Â∫îÁî®Ê®°ÊùøÂà∞ËÆæÂ§áÁªÑ</DialogTitle>
            <DialogDescription>
              ÈÄâÊã©Ë¶ÅÂ∫îÁî®Ê®°Êùø "{selectedTemplate?.name}" ÁöÑËÆæÂ§áÁªÑ
            </DialogDescription>
          </DialogHeader>
          <div className="space-y-4">
            <div>
              <Label>ÈÄâÊã©ËÆæÂ§áÁªÑ</Label>
              <div className="space-y-2 mt-2">
                <div className="flex items-center space-x-2">
                  <Checkbox id="core-switches" />
                  <Label htmlFor="core-switches">Ê†∏ÂøÉ‰∫§Êç¢Êú∫ (8Âè∞ËÆæÂ§á)</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <Checkbox id="access-switches" />
                  <Label htmlFor="access-switches">Êé•ÂÖ•‰∫§Êç¢Êú∫ (45Âè∞ËÆæÂ§á)</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <Checkbox id="server-switches" />
                  <Label htmlFor="server-switches">ÊúçÂä°Âô®‰∫§Êç¢Êú∫ (12Âè∞ËÆæÂ§á)</Label>
                </div>
              </div>
            </div>
            
            {selectedTemplate?.variables?.map((variable: any, index: number) => (
              <div key={index}>
                <Label>{variable.description}</Label>
                <Input 
                  type={variable.type}
                  defaultValue={variable.defaultValue}
                  placeholder={variable.description}
                />
              </div>
            ))}
            
            <div className="flex items-center justify-end space-x-2">
              <Button variant="outline" onClick={() => setShowApplyDialog(false)}>
                ÂèñÊ∂à
              </Button>
              <Button onClick={() => {
                onApplyTemplate?.(selectedTemplate, [])
                setShowApplyDialog(false)
                toast.success("Ê®°ÊùøÂ∫îÁî®ÊàêÂäü")
              }}>
                Â∫îÁî®Ê®°Êùø
              </Button>
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  )
}